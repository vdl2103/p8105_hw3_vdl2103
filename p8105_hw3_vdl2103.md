p8105\_hw3\_vdl2103
================
Tory Lynch

#### Problem 1

##### Load and clean data

``` r
#Load data
data("brfss_smart2010")
#Clean data  
brfss_data <- filter(brfss_smart2010, Topic == "Overall Health") %>% 
  janitor::clean_names() %>% 
  mutate(response = factor(response, c("Excellent", "Very good", "Good", "Fair", "Poor")))
```

##### Questions and plots

``` r
states_with_7_locations <- brfss_data %>%
  filter(year == 2002) %>% 
  group_by(locationabbr) %>% 
  summarise(n = sum(n_distinct(geo_location))) %>% 
  filter(n > 6)

knitr::kable(states_with_7_locations, caption = "States with more than 7 locations in 2002")
```

| locationabbr |    n|
|:-------------|----:|
| CT           |    7|
| FL           |    7|
| MA           |    8|
| NC           |    7|
| NJ           |    8|
| PA           |   10|

The states with more than 7 locations in 2002 are Connecticut, Florida, Massachusetts, North Carolina, New Jersey and Pennsylvania.

``` r
locations_per_state <- brfss_data %>%
  group_by(locationabbr, year) %>% 
  summarise(n = sum(n_distinct(geo_location))) 

plot_locations_per_state <-  ggplot(locations_per_state, aes(x = year, y = n, group = locationabbr, 
                            color = factor(locationabbr))) + geom_point() + geom_line()
```

``` r
prop_excellent_table <- brfss_data %>% 
  filter(year %in% c(2002, 2006, 2010)) %>% 
  filter(locationabbr == "NY" & response == "Excellent") %>% 
  group_by(year) %>% 
  summarise(n = mean(data_value), sd = sd(data_value))
  
  knitr::kable(prop_excellent_table, caption = "Mean and Standard Deviation of Respondents Reporting 
               Excellent Health in New York in 2002, 2006, 2010")
```

|  year|         n|        sd|
|-----:|---------:|---------:|
|  2002|  24.04000|  4.486424|
|  2006|  22.53333|  4.000833|
|  2010|  22.70000|  3.567212|

``` r
five_panel <- brfss_data %>% 
  select(1:3, 7, 9) %>% 
  spread(response, data_value) %>% 
  janitor::clean_names() %>% 
  group_by(year, locationabbr) %>% 
  summarise(excellent_n = mean(excellent), 
            v_good_n = mean(very_good), 
            good_n = mean(good), 
            fair_n = mean(fair), 
            poor_n = mean(poor)) %>% 
gather("response", "data_value", 3:7)

ggplot(five_panel, aes(x = year, y = data_value, color = locationabbr)) + 
        geom_point() + 
        geom_line() + 
        facet_grid(. ~ response)
```

    ## Warning: Removed 21 rows containing missing values (geom_point).

    ## Warning: Removed 2 rows containing missing values (geom_path).

<img src="p8105_hw3_vdl2103_files/figure-markdown_github/unnamed-chunk-5-1.png" width="90%" />

#### Question 2

##### Import data

``` r
data("instacart")
dim(instacart)
```

    ## [1] 1384617      15

``` r
n_distinct(instacart$aisle_id)
```

    ## [1] 134

``` r
max_aisles <- instacart %>% 
  group_by(aisle, department_id) %>% 
  count() %>% 
  arrange(desc(n))

print(max_aisles[1:10,])
```

    ## # A tibble: 10 x 3
    ## # Groups:   aisle, department_id [10]
    ##    aisle                         department_id      n
    ##    <chr>                                 <int>  <int>
    ##  1 fresh vegetables                          4 150609
    ##  2 fresh fruits                              4 150473
    ##  3 packaged vegetables fruits                4  78493
    ##  4 yogurt                                   16  55240
    ##  5 packaged cheese                          16  41699
    ##  6 water seltzer sparkling water             7  36617
    ##  7 milk                                     16  32644
    ##  8 chips pretzels                           19  31269
    ##  9 soy lactosefree                          16  26240
    ## 10 bread                                     3  23635

``` r
ggplot(instacart, aes(x = aisle_id, fill = department)) + geom_histogram(position = "dodge", binwidth = 30)
```

<img src="p8105_hw3_vdl2103_files/figure-markdown_github/unnamed-chunk-7-1.png" width="90%" />

``` r
popular_items_table <- instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle, product_name) %>% 
  count() %>% 
  group_by(aisle) %>% 
  top_n(n = 1)
```

    ## Selecting by n

``` r
apples_and_coffee_table <- instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarise(n = mean(order_hour_of_day)) %>% 
  spread(order_dow, n)
```

#### Problem 3

##### Data import

``` r
data("ny_noaa")
dim(ny_noaa)
```

    ## [1] 2595176       7

``` r
skimr::skim(ny_noaa)
```

    ## Skim summary statistics
    ##  n obs: 2595176 
    ##  n variables: 7 
    ## 
    ## ── Variable type:character ──────────────────────────────────────────────────────────────────────────────────────────────────────
    ##  variable missing complete       n min max empty n_unique
    ##        id       0  2595176 2595176  11  11     0      747
    ##      tmax 1134358  1460818 2595176   1   4     0      532
    ##      tmin 1134420  1460756 2595176   1   4     0      548
    ## 
    ## ── Variable type:Date ───────────────────────────────────────────────────────────────────────────────────────────────────────────
    ##  variable missing complete       n        min        max     median
    ##      date       0  2595176 2595176 1981-01-01 2010-12-31 1997-01-21
    ##  n_unique
    ##     10957
    ## 
    ## ── Variable type:integer ────────────────────────────────────────────────────────────────────────────────────────────────────────
    ##  variable missing complete       n  mean     sd  p0 p25 p50 p75  p100
    ##      prcp  145838  2449338 2595176 29.82  78.18   0   0   0  23 22860
    ##      snow  381221  2213955 2595176  4.99  27.22 -13   0   0   0 10160
    ##      snwd  591786  2003390 2595176 37.31 113.54   0   0   0   0  9195
    ##      hist
    ##  ▇▁▁▁▁▁▁▁
    ##  ▇▁▁▁▁▁▁▁
    ##  ▇▁▁▁▁▁▁▁

``` r
colMeans(is.na(ny_noaa))
```

    ##        id      date      prcp      snow      snwd      tmax      tmin 
    ## 0.0000000 0.0000000 0.0561958 0.1468960 0.2280331 0.4371025 0.4371264

##### Data cleaning

``` r
noaa_data_cleaned <- ny_noaa %>% 
  separate(date, c("y","m", "d")) %>% 
  mutate(prcp_mm = prcp/10) %>%  #put precip into mm 
  mutate(tmax_c = as.numeric(tmax)/10) %>% 
  mutate(tmin_c = as.numeric(tmin)/10)

ggplot(noaa_data_cleaned, aes(x = snow)) + geom_histogram(binwidth = 30) + xlim(c(0,1000))
```

    ## Warning: Removed 381231 rows containing non-finite values (stat_bin).

<img src="p8105_hw3_vdl2103_files/figure-markdown_github/unnamed-chunk-11-1.png" width="90%" />

``` r
max_temp_jan_july <- noaa_data_cleaned %>% 
  filter(m %in% c("01","07")) %>% 
  select(1:3, 11) %>% 
  group_by(id, y, m) %>% 
  summarise(n = mean(tmax_c)) 
  
ggplot(max_temp_jan_july, aes(x = y, y = n, color = id)) + 
        geom_point() + 
        geom_line() + 
        facet_grid(. ~ m) + 
        theme(legend.position = "none")
```

    ## Warning: Removed 7058 rows containing missing values (geom_point).

    ## Warning: Removed 7058 rows containing missing values (geom_path).

    ## geom_path: Each group consists of only one observation. Do you need to
    ## adjust the group aesthetic?
    ## geom_path: Each group consists of only one observation. Do you need to
    ## adjust the group aesthetic?

<img src="p8105_hw3_vdl2103_files/figure-markdown_github/unnamed-chunk-12-1.png" width="90%" />

``` r
max_vs_min_plot <- ggplot(noaa_data_cleaned, aes(x = tmax_c, y = tmin_c)) + geom_hex()
snow_dist_plot <- ggplot(noaa_data_cleaned, aes(x = snow, y = y)) + geom_density_ridges() + xlim(c(1,100))
snow_dist_plot_violin <- ggplot(noaa_data_cleaned, aes(x = y, y = snow)) + geom_violin(aes(fill = y)) + stat_summary(fun.y = median, geom = "point", color = "black", size = 1) + ylim(c(1,100)) + theme(legend.position = "none")

max_vs_min_plot + snow_dist_plot
```

    ## Warning: Removed 1136276 rows containing non-finite values (stat_binhex).

    ## Picking joint bandwidth of 3.76

    ## Warning: Removed 2422605 rows containing non-finite values
    ## (stat_density_ridges).

<img src="p8105_hw3_vdl2103_files/figure-markdown_github/unnamed-chunk-13-1.png" width="90%" />
